# LLM Translation Prepare V2 - –ü–∞—Ä—Å–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

## –û–ø–∏—Å–∞–Ω–∏–µ

–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ø–∞—Ä—Å–µ—Ä–∞ `llm_translate_prepare_v2.py` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å **–∏—Å—Ö–æ–¥–Ω—ã–º–∏** —Ñ–∞–π–ª–∞–º–∏ –∏–∑ `extracted_scripts/` –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞—Ö –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∞.

## –û—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è –æ—Ç V1

| –§—É–Ω–∫—Ü–∏—è | V1 | V2 |
|---------|----|----|
| –ò—Å—Ç–æ—á–Ω–∏–∫ | `translation_modules/*_ru.rpy` | `extracted_scripts/*.rpy` |
| –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| –ü–æ–ª –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ (—á–µ—Ä–µ–∑ –∫–∞—Ä—Ç—É) |
| Show –∫–æ–º–∞–Ω–¥—ã | ‚ùå –ù–µ—Ç | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç |
| –ö–∞—Ä—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π | ‚ùå –ù–µ—Ç | ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |

## –§–æ—Ä–º–∞—Ç JSON

### –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º

```json
{
  "id": 103,
  "line": 762,
  "file": "c1.rpy",
  "speaker": "maid",
  "speaker_prefix": "maid",
  "speaker_gender": "female",
  "original": "H-hello? [namepov!tc]?",
  "translation": "",
  "context": "dialogue",
  "tags": [],
  "variables_curly": [],
  "variables_square": ["namepov!tc"],
  "special_chars": {
    "newlines": 0,
    "tabs": 0,
    "escaped_quotes": 0,
    "has_formatting": false
  }
}
```

### –ù–æ–≤—ã–µ –ø–æ–ª—è

- **`speaker`** - —Å—É—â–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (maid, princess, nmaid –∏ —Ç.–¥.)
- **`speaker_prefix`** - –ø—Ä–µ—Ñ–∏–∫—Å (n = narrator, –∏–ª–∏ –∏–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞)
- **`speaker_gender`** - –ø–æ–ª –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (male/female/neutral/unknown)
- **`line`** - –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ

## –ö–∞—Ä—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

–ü–∞—Ä—Å–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–≤—É–º—è —Ç–∏–ø–∞–º–∏ —Ñ–∞–π–ª–æ–≤:
- **`data/characters.json`** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –≥–µ–Ω–¥–µ—Ä–∞–º–∏ (—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é)
- **`data/characters_–î–î.–ú–ú.–ì–ì–ì–ì-–ß–ß:–ú–ú:–°–°.json`** - —Ñ–∞–π–ª—ã —Å –Ω–æ–≤—ã–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–∞—Ä—Å–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç `data/characters.json`
2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏
3. –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ —Ñ–∞–π–ª —Å –¥–∞—Ç–æ–π
4. –ï—Å–ª–∏ –Ω–æ–≤—ã—Ö –Ω–µ—Ç - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

```json
{
  "maid": {
    "entities": ["maid", "nmaid"],
    "gender": "",
    "notes": ""
  },
  "princess": {
    "entities": ["princess", "nprincess"],
    "gender": "",
    "notes": ""
  }
}
```

**–ó–∞–¥–∞—á–∞ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞:** –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ `gender` –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:
- `"male"` - –º—É–∂—Å–∫–æ–π –ø–æ–ª
- `"female"` - –∂–µ–Ω—Å–∫–∏–π –ø–æ–ª
- `"neutral"` - –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π/–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π
- `"unknown"` - —Ç–æ—á–Ω–æ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

```bash
python3 llm_translate_prepare_v2.py \
  --source ../extracted_scripts/c1.rpy \
  --output ../temp_files/c1_v2.json \
  --character-map ../data/characters.json
```

### 2. –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```bash
python3 llm_translate_prepare_v2.py \
  --batch ../extracted_scripts \
  --batch-output ../temp_files/llm_json_v2 \
  --character-map ../data/characters.json
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ä—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—ã –∑–∞–ø–æ–ª–Ω–∏–ª–∏ `gender` –≤ —Ñ–∞–π–ª–µ `characters-11.10.2025.json`:

```bash
# –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å —É—á–µ—Ç–æ–º –ø–æ–ª–∞
python3 llm_translate_prepare_v2.py \
  --source ../extracted_scripts/c1.rpy \
  --output ../temp_files/c1_v2.json \
  --character-map ../data/characters-11.10.2025.json
```

–¢–µ–ø–µ—Ä—å –ø–æ–ª–µ `speaker_gender` –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –≤ JSON.

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

### –ü—Ä—è–º–∞—è —Ä–µ—á—å —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

```renpy
maid talk "H-hello? [namepov!tc]?"
princess "Come out, little one."
```

–ü–∞—Ä—Å–∏—Ç—Å—è –∫–∞–∫:
- `speaker: "maid"`, `original: "H-hello? [namepov!tc]?"`
- `speaker: "princess"`, `original: "Come out, little one."`

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ show –∫–æ–º–∞–Ω–¥—ã

```renpy
show princess normal at offscreenright

"You are in a vast, richly decorated chamber."
```

–ü–∞—Ä—Å–∏—Ç—Å—è –∫–∞–∫:
- `speaker: "princess"`, `original: "You are in a vast..."`

### –ü–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ (narrator)

```renpy
nprincess "She smiles warmly at you."
```

–ü–∞—Ä—Å–∏—Ç—Å—è –∫–∞–∫:
- `speaker: "nprincess"`, `speaker_prefix: "n"`, `context: "narration"`

## Workflow —Å –∫–∞—Ä—Ç–æ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

### –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–°–æ–∑–¥–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π:**
   ```bash
   python3 llm_translate_prepare_v2.py --batch ../extracted_scripts --character-map ../data/characters.json
   ```
   –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `data/characters_11.10.2025-01:25:24.json` —Å–æ –≤—Å–µ–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏

2. **–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π:**
   –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ —Å –¥–∞—Ç–æ–π –≤ `data/characters.json` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ `gender`:
   ```json
   {
     "maid": {
       "entities": ["maid", "nmaid"],
       "gender": "female",
       "notes": "–°–ª—É–∂–∞–Ω–∫–∞ –ø—Ä–∏–Ω—Ü–µ—Å—Å—ã"
     },
     "princess": {
       "entities": ["princess", "nprincess"],
       "gender": "female",
       "notes": ""
     }
   }
   ```

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ø–µ—Ä–µ–≤–æ–¥–µ:**
   ```bash
   python3 llm_translate_prepare_v2.py --batch ../extracted_scripts --character-map ../data/characters.json
   ```
   –ü–∞—Ä—Å–µ—Ä –∑–∞–≥—Ä—É–∑–∏—Ç –≥–µ–Ω–¥–µ—Ä—ã –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ –¥–æ–±–∞–≤–∏—Ç –∏—Ö –≤ JSON –¥–ª—è LLM

### –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–≥—Ä—ã

–ï—Å–ª–∏ –≤—ã—à–ª–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –∏–≥—Ä—ã —Å –Ω–æ–≤—ã–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–µ—Ä:**
   ```bash
   python3 llm_translate_prepare_v2.py --batch ../extracted_scripts --character-map ../data/characters.json
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–≤–æ–¥:**
   ```
   ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–∞—Ä—Ç–∞: ../data/characters.json
   üíæ –ù–æ–≤—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: ../data/characters_11.10.2025-14:30:15.json
      –ù–æ–≤—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π: 3
   ```

3. **–ó–∞–ø–æ–ª–Ω–∏—Ç—å –≥–µ–Ω–¥–µ—Ä—ã –Ω–æ–≤—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π:**
   –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª —Å –¥–∞—Ç–æ–π, –ø—Ä–æ—Å—Ç–∞–≤—å—Ç–µ `gender` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π `characters.json`

4. **–ì–æ—Ç–æ–≤–æ:**
   –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –Ω–æ–≤—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ –±—É–¥—É—Ç —É—á—Ç–µ–Ω—ã

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞

- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–æ–¥** - LLM –∑–Ω–∞–µ—Ç –ø–æ–ª –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- ‚úÖ **–ö–æ–Ω—Ç–µ–∫—Å—Ç** - –≤–∏–¥–Ω–æ, –∫—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç
- ‚úÖ **–ü–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ** - —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –¥–∏–∞–ª–æ–≥–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è
- ‚úÖ **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** - –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–µ

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

V2 –ø–∞—Ä—Å–µ—Ä **–Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç** V1, –∞ –¥–æ–ø–æ–ª–Ω—è–µ—Ç –µ–≥–æ:
- **V1** - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–æ—Ç–æ–≤—ã–º–∏ –º–æ–¥—É–ª—è–º–∏ –ø–µ—Ä–µ–≤–æ–¥–∞
- **V2** - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

## –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ª—É–∂–µ–±–Ω—ã—Ö —Å–ª–æ–≤

–ü–∞—Ä—Å–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞–µ—Ç —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞ RenPy:
- `if`, `else`, `menu`, `centered`, `extend`, `nvl`
- `show`, `hide`, `with`, `scene`, `play`, `stop`
- –ò –¥—Ä—É–≥–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

–ï—Å–ª–∏ –∫–∞–∫–æ–µ-—Ç–æ —Å–ª–æ–≤–æ –æ—à–∏–±–æ—á–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è –∫–∞–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂, –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ `RENPY_KEYWORDS` –≤ –∫–æ–¥–µ –ø–∞—Ä—Å–µ—Ä–∞.
