# ü§ñ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ LLM-–ø–µ—Ä–µ–≤–æ–¥—É Ravager

## üìã –û–±–∑–æ—Ä

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –∏–≥—Ä—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–π fine-tuned –º–æ–¥–µ–ª–∏ **Saiga** —á–µ—Ä–µ–∑ Ollama.

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ –º–æ–¥–µ–ª—å (fine-tuning)
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞: `[INST]–ü–µ—Ä–µ–≤–µ–¥–∏: "Text"[/INST]`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, —Ç–µ–≥–æ–≤ –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏: `temperature=0.1`, `top_p=0.7`

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## üîÑ –ü–∞–π–ø–ª–∞–π–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏

### üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π:

```bash
cd tools
./llm_batch_translate.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ JSON –∏–∑ `.rpy` —Ñ–∞–π–ª–æ–≤ (`translation_modules/`)
2. –ü–µ—Ä–µ–≤–æ–¥ —á–µ—Ä–µ–∑ Ollama API (–º–æ–¥–µ–ª—å Saiga)
3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –æ–±—Ä–∞—Ç–Ω–æ –≤ `.rpy`
4. –£–ø–∞–∫–æ–≤–∫–∞ –≤ `game/tl/ru/`

### üîß –†—É—á–Ω–æ–π –ø–µ—Ä–µ–≤–æ–¥ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è

**–®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**
```bash
cd tools
python3 llm_translate_prepare.py --module ../translation_modules/c1_ru.rpy
```
‚Üí –°–æ–∑–¥–∞–µ—Ç `temp_files/llm_json/c1_ru.json`

**–®–∞–≥ 2: –ü–µ—Ä–µ–≤–æ–¥**
```bash
python3 llm_translate.py \
  --input ../temp_files/llm_json/c1_ru.json \
  --output ../temp_files/llm_json/c1_ru_translated.json \
  --backend ollama \
  --api-url http://127.0.0.1:11434/api/chat \
  --model saiga \
  --temperature 0.1 \
  --top-p 0.7
```

**–®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**
```bash
python3 llm_translate_apply.py \
  --input ../temp_files/llm_json/c1_ru_translated.json \
  --module ../translation_modules/c1_ru.rpy
```

**–®–∞–≥ 4: –£–ø–∞–∫–æ–≤–∫–∞**
```bash
python3 smart_pack_translations.py
```

**–®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
```bash
cd .. && ./Ravager.sh
```

---

## üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–µ—Ä–µ–≤–æ–¥–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```bash
cd tools
python3 translation_helper.py --status
```

**–í—ã–≤–æ–¥:**
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥—É–ª–µ–π
- –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –¢–æ–ø –º–æ–¥—É–ª–µ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ä–∞–∑–º–µ—Ä—É)
- –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ `translation_work_plan.md`

### –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞–∑—Ü–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞

```bash
python3 translation_helper.py --create-sample <module_name>
```

–°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª `sample_<module>_ru.txt` —Å –ø—Ä–∏–º–µ—Ä–æ–º –ø–µ—Ä–≤—ã—Ö 10 —Å—Ç—Ä–æ–∫.

---

## üìä –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

```python
def validate_translation(original: str, translation: str) -> List[str]:
    errors = []
    
    # 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    orig_vars_curly = set(re.findall(r'\{(\w+)\}', original))
    trans_vars_curly = set(re.findall(r'\{(\w+)\}', translation))
    if orig_vars_curly != trans_vars_curly:
        errors.append(f"–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö {{}}: {orig_vars_curly} != {trans_vars_curly}")
    
    orig_vars_square = set(re.findall(r'\[(\w+)\]', original))
    trans_vars_square = set(re.findall(r'\[(\w+)\]', translation))
    if orig_vars_square != trans_vars_square:
        errors.append(f"–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö []: {orig_vars_square} != {trans_vars_square}")
    
    # 2. –¢–µ–≥–∏
    orig_tags = re.findall(r'\{/?(?:color|b|i|u|size|center)[^}]*\}', original)
    trans_tags = re.findall(r'\{/?(?:color|b|i|u|size|center)[^}]*\}', translation)
    if orig_tags != trans_tags:
        errors.append(f"–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ–≥–æ–≤: {orig_tags} != {trans_tags}")
    
    # 3. –°–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
    if original.count('\\n') != translation.count('\\n'):
        errors.append(f"–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ \\n: {original.count('\\n')} != {translation.count('\\n')}")
    
    # 4. –ö–∞–≤—ã—á–∫–∏
    if '"' in translation and '\\"' not in original:
        errors.append("–ö–∞–≤—ã—á–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã: \\\"")
    
    return errors
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### JSON –¥–ª—è LLM (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)

```json
{
  "metadata": {
    "module": "c1_ru.rpy",
    "total_strings": 236,
    "source_language": "en",
    "target_language": "ru"
  },
  "strings": [
    {
      "id": 0,
      "comment": "c1.rpy:123",
      "original": "Hello, Dragon!",
      "translation": "",
      "context": "dialogue",
      "tags": [],
      "variables": []
    }
  ]
}
```

### –ü–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞

```json
{
  "strings": [
    {
      "id": 0,
      "comment": "c1.rpy:123",
      "original": "Hello, Dragon!",
      "translation": "–ü—Ä–∏–≤–µ—Ç, –î—Ä–∞–∫–æ–Ω!",
      "context": "dialogue",
      "tags": [],
      "variables": []
    }
  ]
}
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∫–∞—á–µ—Å—Ç–≤–∞

–ü–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–µ—Ä–µ–≤–æ–¥–∞:

- [ ] –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `{var}` –∏ `[var]` —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- [ ] –í—Å–µ —Ç–µ–≥–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- [ ] –°–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã `\n`, `\t` –Ω–∞ –º–µ—Å—Ç–µ
- [ ] –ö–∞–≤—ã—á–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã `\"`
- [ ] –ù–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –≤ –ø–µ—Ä–µ–≤–æ–¥–µ
- [ ] –°—Ç–∏–ª—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç—É (–¥–∏–∞–ª–æ–≥/–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- [ ] –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞
- [ ] –ü–µ—Ä–µ–≤–æ–¥ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ UI (–¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞)
- [ ] –ù–µ—Ç –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

---

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "invalid syntax" –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤ –∏–≥—Ä—É

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
```renpy
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
new "–û–Ω —Å–∫–∞–∑–∞–ª "–ü—Ä–∏–≤–µ—Ç""

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
new "–û–Ω —Å–∫–∞–∑–∞–ª \"–ü—Ä–∏–≤–µ—Ç\""
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ —Ç–µ–∫—Å—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –±—ã–ª–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
```renpy
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
new "–£ —Ç–µ–±—è {–∑–æ–ª–æ—Ç–æ} –∑–æ–ª–æ—Ç–∞"

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
new "–£ —Ç–µ–±—è {gold} –∑–æ–ª–æ—Ç–∞"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ–∫—Å—Ç –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –∫–Ω–æ–ø–∫—É

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–≤–æ–¥ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
```renpy
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
old "Auto"
new "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
old "Auto"
new "–ê–≤—Ç–æ"
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –û –ø—Ä–æ–º–ø—Ç–∞—Ö –∏ –ø—Ä–∞–≤–∏–ª–∞—Ö –ø–µ—Ä–µ–≤–æ–¥–∞

**–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** - –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ fine-tuned –º–æ–¥–µ–ª—å Saiga.

–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–π:
```
[INST]–ü–µ—Ä–µ–≤–µ–¥–∏: "Your text here"[/INST]
```

–ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞:
- –ù–µ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `{var}` –∏ `[var]`
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–µ–≥–∏ `{color=...}`, `{b}`, `{/b}` –∏ —Ç.–¥.
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ `\n` (–ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ "—Ç—ã" –≤ –¥–∏–∞–ª–æ–≥–∞—Ö

### –û –∫–∞—á–µ—Å—Ç–≤–µ –ø–µ—Ä–µ–≤–æ–¥–∞

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∞ (options_ru.json, 23 —Å—Ç—Ä–æ–∫–∏):**
- ‚úÖ 100% —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ (23/23)
- ‚úÖ –í—Å–µ —Ç–µ–≥–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –í—Å–µ URL –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úÖ –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–µ–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

### –ü—Ä–æ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

–í–∞–ª–∏–¥–∞—Ç–æ—Ä Python –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö `{var}` –∏ `[var]`
2. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ–≥–æ–≤ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ `\n` –∏ `\t`
4. –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–≤—ã—á–µ–∫ `\"`

–ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Ä—É—á–Ω—É—é.

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **`LLM_QUICKSTART.md`** - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç LLM-–ø–µ—Ä–µ–≤–æ–¥–∞
- **`WORKFLOW.md`** - –æ–±—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–≤–æ–¥–∞
- **`tools/README.md`** - –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- **`translation_work_plan.md`** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –ø–ª–∞–Ω —Ä–∞–±–æ—Ç—ã

---

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ollama
curl -fsSL https://ollama.com/install.sh | sh
ollama pull saiga

# 2. –ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–≤–æ–¥–∞
cd tools
./llm_batch_translate.sh

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
python3 translation_helper.py --status

# 4. –£–ø–∞–∫–æ–≤–∫–∞ –∏ —Ç–µ—Å—Ç
python3 smart_pack_translations.py
cd .. && ./Ravager.sh
```
